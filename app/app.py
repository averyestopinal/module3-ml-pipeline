import os
import yaml
import gradio as gr
import pandas as pd

# point to config.yaml so server uses same paths as scripts
CONFIG_PATH = os.path.join(os.path.dirname(__file__), "..", "config.yaml")
if os.path.exists(CONFIG_PATH):
    with open(CONFIG_PATH, "r") as f:
        cfg = yaml.safe_load(f)
else:
    cfg = {}

# read artifacts paths from config 
PREPROCESSOR_PATH = cfg.get("artifacts", {}).get("preprocessor", "artifacts/preprocessor.joblib")
MODEL_PATH = cfg.get("artifacts", {}).get("model", "artifacts/model.joblib")
EXPECTED_COLS = cfg.get("data", {}).get("input_columns", None)
if EXPECTED_COLS is None:
    # is not present EXPECTED_COLS becomes empty
    EXPECTED_COLS = []

ENTRY_COLS = [
    "Company",
    "Altitude",
    "Region",
    "Producer",
    "Harvest.Year",
    "Variety",
    "Expiration"
]

UI_COLS = [col for col in EXPECTED_COLS if col in ENTRY_COLS]
# The above snippet was generated by chatGPT 5.1 at 1:40p on 11/22/25.


# All column entries for interface
empty_df = pd.DataFrame([{col: "" for col in UI}])
# The above snippet was generated by chatGPT 5.1 at 2:33p on 11/21/25 and modified to traverse the correct list.

def cup_points_estimator(known_values_list):
    # API call here
    points = 0
    return points

# Simple Gradio interface
demo = gr.Interface(
    fn=cup_points_estimator,

    # Citation: OpenAI. (2025). ChatGPT (Version 5.1) [Large language model]. https://chat.openai.com 
    #   Conversation with ChatGPT on February 11, 2025, used to generate the Gradio app code for a coffee cup-points estimator.
    inputs=gr.Dataframe(
        headers=UI_COLS,
        value=empty_df,
        row_count=1,
        col_count=len(UI_COLS),
        interactive=True,
        label="Enter Known Values"
    ),
    outputs=gr.Number(label="Estimated Coffee Cup Points (A score above 80 is generally considered as a speciality coffee)"),
    # ----------------END CITED BLOCK-------------------------

    title="Coffee Cup Points Estimator",
    description="Enter known values for coffee into table. The estimated Cop Score from a Q Grader trained by the Coffee Quality Institute will be predicted."
)

demo.launch()